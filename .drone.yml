#workspace:
#  base: /go
#  path: src/github.com/zhanghudong/drone-test
#
#pipeline:
#  testing:
#    image: golang:latest
#    commands:
#      - go env
#      - go version
#      - go build
#  publish:
#    image: plugins/docker
#    repo: zhanghudong/drone-test
#    dockerfile: Dockerfile
#    tags: latest
#    pull: true
#    registry: https://cloud.docker.com
#    group: release
#    auto_tag: true
#    when:
#      event: [ push, tag ]
#      local: false


#kind: pipeline
#name: default
#
#steps:
#  - name: test
#    image: golang
#    volumes:
#      - name: deps
#        path: /go
#    commands:
#      - go test
#  - name: build
#    image: golang
#    volumes:
#      - name: deps
#        path: /go
#    commands:
#      - go build
#
#  - name: docker
#    image: plugins/docker
#    repo: zhanghudong/drone-test
#    dockerfile: Dockerfile
#    tags: latest
#    pull: true


pipeline:
  backend:
    image: golang
    commands:
      - go get
      - go build
      - go test

  publish:
    image: plugins/docker
    repo: zhanghudong/drone-test
    tags: [ 1, 1.1, latest ]
    registry: index.docker.io

  notify:
    image: plugins/slack
    channel: developers
    username: drone